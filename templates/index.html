<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Reserva Chablé</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="wrapper">
    <header class="site-header">
      <img src="{{ url_for('static', filename='logo.png') }}" alt="Chablé" class="logo">
    </header>
    <div class="form-container">
      <h1>Buscar reserva</h1>

      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <ul class="flashes">
            {% for cat,msg in messages %}
              <li class="{{ cat }}">{{ msg }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      {% endwith %}

      <form method="post" action="{{ url_for('search') }}" class="search-form">
        <div class="field-group">
          <label for="Pms_Confirm_No">{{ display_names.get('Pms_Confirm_No','Número de confirmación') }}</label>
          <input id="Pms_Confirm_No" name="Pms_Confirm_No" type="text"
                 placeholder="Ej. ABC123" value="{{ request.form.Pms_Confirm_No }}">
        </div>
        <div class="field-group">
          <label for="CSV_Guest_NM">{{ display_names.get('CSV_Guest_NM','Nombre huésped') }}</label>
          <input id="CSV_Guest_NM" name="CSV_Guest_NM" type="text"
                 placeholder="Ej. Juan Pérez" value="{{ request.form.CSV_Guest_NM }}">
        </div>
        <div class="field-group">
          <label for="CSV_Cust_Email">{{ display_names.get('CSV_Cust_Email','Email') }}</label>
          <input id="CSV_Cust_Email" name="CSV_Cust_Email" type="email"
                 placeholder="Ej. correo@dominio.com" value="{{ request.form.CSV_Cust_Email }}">
        </div>
        <div class="field-group">
          <label for="CSV_Arrival_Date">{{ display_names.get('CSV_Arrival_Date','Check-in') }}</label>
          <input id="CSV_Arrival_Date" name="CSV_Arrival_Date" type="date"
                 value="{{ request.form.CSV_Arrival_Date }}">
        </div>
        <div class="field-group">
          <label for="Which_Date">{{ display_names.get('Which_Date','Fecha reserva') }}</label>
          <input id="Which_Date" name="Which_Date" type="date"
                 value="{{ request.form.Which_Date }}">
        </div>

        <button type="submit">Buscar</button>
      </form>

      {% if records %}
        <div class="results-container">
          <h2>Reservas encontradas</h2>
          <table class="results-table">
            <thead>
              <tr>
                <th>{{ display_names.get('CSV_Guest_NM','Nombre huésped') }}</th>
                <th>{{ display_names.get('CSV_Cust_Email','Email') }}</th>
                <th>{{ display_names.get('Pms_Confirm_No','Confirmación') }}</th>
                <th>Acción</th>
              </tr>
            </thead>
            <tbody>
              {% for r in records %}
              <tr>
                <td>{{ r.CSV_Guest_NM }}</td>
                <td>{{ r.CSV_Cust_Email }}</td>
                <td>{{ r.Pms_Confirm_No }}</td>
                <td>
                  <button type="button"
                    onclick="location.href='{{ url_for('edit_record', row_idx=r.row_idx) }}'">
                    Editar
                  </button>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% endif %}

    </div>
  </div>
</body>
</html>
